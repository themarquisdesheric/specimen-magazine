<script lang="ts">
  import type { Issue } from '../types';
  import Tag from './Tag.svelte'

  export let issue: Issue

  const {
    number,
    title,
    professors,
  } = issue
  const MAX_PROFESSOR_LENGTH = 5

  let headerWidth = 222
</script>
<a href="/issues/{number}" rel="prefetch" class="issue-card w-full border rounded text-sm p-4 mb-4 shadow-md">
  <header
    bind:clientWidth={headerWidth}
    style="--headerWidth: {headerWidth}px;"
    class="relative mb-4 text-white"
  >
    <img src="/issues/{number}.jpg" alt="{title} issue" />
    <h2 class="absolute font-bold text-xl">{title}</h2>
  </header>
  {#each professors as professor, index}
    {#if index === MAX_PROFESSOR_LENGTH && professors.length - 1 > MAX_PROFESSOR_LENGTH}
      <section class="py-1 flex justify-between items-center">  
        <p class="font-light">+ {professors.length - MAX_PROFESSOR_LENGTH} more</p>
      </section>
    {:else if index <= MAX_PROFESSOR_LENGTH}
      <section class="py-1 flex justify-between items-center">
        <p class="text-left mr-1">{professor.name}</p>
        <Tag tag={professor.tags[0]} />
      </section>

      {#if index !== professors.length - 1}
        <hr class="my-1" />
      {/if}
    {/if}
  {/each}
</a>

<style>
  h2 {
    /* fluid font magic https://css-tricks.com/snippets/css/fluid-typography/ */
    font-size: calc(1.25rem + 6 * ((100vw - 320px) / 90));
    bottom: .5em;
    left: .5em;
  }

  img {
    object-fit: cover;
    height: var(--headerWidth);
    width: 100%;
  }

  @media (min-width: 600px) {
    h2 {
      font-size: 1.25rem;
      left: .75em;
    }

    .issue-card {
      width: calc(50% - .5rem);
    }
  }

  @media (min-width: 850px) {
    .issue-card {
      width: calc(33% - .5rem);
    }
  }
</style>
